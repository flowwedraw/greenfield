<!DOCTYPE html>
<!-- saved from url=(0042)https://www.crockford.com/deconstruct.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="author" content="Douglas Crockford">
<meta name="copyright" content="(C)2025 Douglas Crockford">
<meta name="date" content="2025">
<meta http-equiv="Expires" content="1968-12-09">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<link rel="stylesheet" href="./Deconstruct_files/crockford.css" type="text/css">
<link rel="icon" type="image/png" href="https://www.crockford.com/favicon.png">
<title>Deconstruct</title>
<style>
input {
    border-radius: 0.5em;
    border: 1pt solid black;
    font-family: Programma, mono;
    font-size: 100%;
    font-style: normal;
    font-weight: bold;
    margin-left: 1em;
    margin-right: 1em;
    padding-left: 1em;
    padding-right: 1em;
}

</style>
</head>
<body>
<div id="side">
    <div id="name"><a href="https://www.crockford.com/"><big>Douglas Crockford</big></a></div><br>
    <p><a href="https://www.crockford.com/blog.html">Blog</a></p>
    <p><a href="https://www.crockford.com/books.html">Books</a></p>
    <p><a href="https://www.crockford.com/videos.html">Videos</a></p>
    <p><a href="https://www.crockford.com/2025.html">2025 Appearances</a></p>
    <p><a href="https://www.crockford.com/slides.html">Slides</a></p>
    <p><a href="https://www.crockford.com/javascript/">JavaScript</a></p>
    <p><a href="https://mistysystem.com/">Misty</a></p>
    <p><a href="https://jslint.com/">JSLint</a></p>
    <p><a href="https://json.org/">JSON</a></p>
    <p><a href="https://github.com/douglascrockford">Github</a></p>
    <p><a href="https://www.crockford.com/ec.html">Electric Communities</a></p>
    <p><a href="https://www.flickr.com/photos/douglascrockford/albums/72157644699201976">Flickr Photo Album</a></p>
    <p><a href="https://www.linkedin.com/in/douglas-crockford-724600109/">LinkedIn</a></p>
    <p><a rel="me" href="https://layer8.space/@douglascrockford">Mastodon/Layer8</a></p>
    <p><a href="https://www.researchgate.net/profile/Douglas-Crockford">ResearchGate</a></p>
    <p><a href="https://www.crockford.com/pronouns.html">Pronouns: <dfn>pe/per</dfn></a></p>
    <p><a href="https://lz953.isrefer.com/go/preorder/B53xn5cY">Aptera</a></p>
    <p><a href="https://www.crockford.com/about.html">About</a></p>
</div>
<div id="blog">
<time>2024-04-28</time>
<h1>Deconstruct</h1>

<script src="./Deconstruct_files/deconstruct.js.Без названия"></script>
<script type="module">

import big_integer from "./big_integer.js";
import big_float from "./big_float.js";

function set_text(node, text) {
    node.innerHTML = "";
    node.append(String(text));
    return node;
}

let big_one = big_float.make(1);
let big_two = big_float.make(2);

function power_of_two(exponent) {
    let result = big_one;
    while (exponent > 0) {
        result = big_float.mul(result, big_two);
        exponent -= 1;
    }
    while (exponent < 0) {
        result = big_float.div(result, big_two, -100);
        exponent += 1;
    }
    return result;
}

const blog = document.getElementById("blog");
const input = document.getElementById("input");
const output = document.getElementById("output");

function show(deconstruction) {
    if (typeof deconstruction === "string") {
        output.replaceChildren(deconstruction);
        return;
    }
    output.replaceChildren(
        (
            deconstruction.sign < 0
            ? "-"
            : ""
        ) + deconstruction.coefficient + " * (" + deconstruction.exponent + " ** 2)",
        document.createElement("hr"),
        big_float.string(
            big_float.mul(
                big_float.make(deconstruction.sign * deconstruction.coefficient),
                power_of_two(deconstruction.exponent)
            )
        )
    );
}

function evaluate(string) {
    if (string.length > 0) {
        let at = string.search(/[^(\s0123456789eE.+\-*\/)]/);
        if (at >= 0) {
            return string[at];
        }
        try {
            let value = eval(string);
            if (Number.isFinite(value)) {
                return deconstruct(value);
            }
        } catch (ignore) {}
    }
    return undefined;
}

function work() {
    let value = evaluate(input.value);
    if (typeof value === "string") {
        output.replaceChildren(value);
    } else if (typeof value === "object") {
        output.replaceChildren(
            (
                value.sign < 0
                ? "-"
                : ""
            ) + value.coefficient + " * (" + value.exponent + " ** 2)",
            document.createElement("hr"),
            big_float.string(
                big_float.mul(
                    big_float.make(value.sign * value.coefficient),
                    power_of_two(value.exponent)
                )
            )
        );
    }  else {
        output.replaceChildren("");
    }
}

input.addEventListener(
    "input",
    function (e) {
        work();
    },
    false
);
Array.from(blog.getElementsByTagName("input")).forEach(function (node) {
    if (node.type === "button") {
        node.addEventListener(
            "click",
            function (event) {
                input.value = node.value;
                work();
                input.focus();
            },
            false
        );
    }
});

input.focus();
</script>
<p style="text-align: center;">Enter a numeric expression:&nbsp; <input type="text" id="input" minlength="32" style="width: 32em;"></p>
<pre id="output" style="background-color: lavender; border: 1pt solid black; padding: 1em; text-align: center;"></pre>
<p style="text-align: center;">
    <input type="button" value="0.1">
    <input type="button" value="0.1 + 0.2">
    <input type="button" value="0.3">
    <input type="button" value="1.0e23">
    <input type="button" value="98.6">
</p>
<p>I wrote a function called <code>deconstruct</code> for <a href="https://www.crockford.com/books.html"><em>How JavaScript Works</em></a>.
    It breaks a binary floating point number down to its fundamental parts.
    You can use those parts to precisely compute the actual numeric value.
    If the number includes a decimal point or is very large, it is likely that its actual value is different than its literal value.
    This difference is called an <b>error</b>.</p>
<p><a href="https://www.crockford.com/dec64.html">DEC64</a> does not have this error.</p>
    <h5><a href="https://www.crockford.com/dec64.html">DEC64</a></h5>

</div>



</body></html>