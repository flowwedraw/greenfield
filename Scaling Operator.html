<!DOCTYPE html>
<!-- saved from url=(0038)https://www.crockford.com/scaling.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="author" content="Douglas Crockford">
<meta name="copyright" content="(C)2025 Douglas Crockford">
<meta name="date" content="2025">
<meta http-equiv="Expires" content="1968-12-09">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<link rel="stylesheet" href="./Scaling Operator_files/crockford.css" type="text/css">
<link rel="icon" type="image/png" href="https://www.crockford.com/favicon.png">
<title>Scaling Operator</title>
</head>
<body>
<div id="side">
    <div id="name"><a href="https://www.crockford.com/"><big>Douglas Crockford</big></a></div><br>
    <p><a href="https://www.crockford.com/blog.html">Blog</a></p>
    <p><a href="https://www.crockford.com/books.html">Books</a></p>
    <p><a href="https://www.crockford.com/videos.html">Videos</a></p>
    <p><a href="https://www.crockford.com/2025.html">2025 Appearances</a></p>
    <p><a href="https://www.crockford.com/slides.html">Slides</a></p>
    <p><a href="https://www.crockford.com/javascript/">JavaScript</a></p>
    <p><a href="https://mistysystem.com/">Misty</a></p>
    <p><a href="https://jslint.com/">JSLint</a></p>
    <p><a href="https://json.org/">JSON</a></p>
    <p><a href="https://github.com/douglascrockford">Github</a></p>
    <p><a href="https://www.crockford.com/ec.html">Electric Communities</a></p>
    <p><a href="https://www.flickr.com/photos/douglascrockford/albums/72157644699201976">Flickr Photo Album</a></p>
    <p><a href="https://www.linkedin.com/in/douglas-crockford-724600109/">LinkedIn</a></p>
    <p><a rel="me" href="https://layer8.space/@douglascrockford">Mastodon/Layer8</a></p>
    <p><a href="https://www.researchgate.net/profile/Douglas-Crockford">ResearchGate</a></p>
    <p><a href="https://www.crockford.com/pronouns.html">Pronouns: <dfn>pe/per</dfn></a></p>
    <p><a href="https://lz953.isrefer.com/go/preorder/B53xn5cY">Aptera</a></p>
    <p><a href="https://www.crockford.com/about.html">About</a></p>
</div>
<div id="blog">
<time>2023-02-08</time>
<h1>Scaling Operator</h1>

<p>In most programming languages that have an <code>int</code> type, the most significant bits of the product of
multiplication are thrown away
    without warning, which can obviously lead to errors. This can not be blamed on the hardware,
    because most CPUs that provide multiplication can produce results with twice the number of bits as the input.
    So, on an x64, or ARM64, or some RISC-V, a 64-bit multiply yields a 128-bit product.</p>
<p>One way of expressing this in a programming language would be with a new ternary operator: the fused multiply-divide,
also known as the scaling operator. It takes three operands:</p>
<pre> multiplicand × multiplier ÷ divisor</pre>
<p>It makes use of a double wide dividend to avoid overflow errors. On Intel processors, you use the <code>imul</code>
and <code>idiv</code> instructions together.</p>
<pre>mov  a, multiplicand
imul multiplier ; multiply a and the multiplier, putting the product in d:a.
idiv divisor    ; divide d:a by the divisor, putting the quotient in a.
jo   overflow   ; take action if the quotient was too big for a.</pre>
<p>The <code>idiv</code> instruction takes a double wide dividend. The overflow test is to guard against the possibility of the
quotient not fitting nicely into the result type, which could occur if the multiplicand and multiplier are large and the
divisor is small. Unfortunately, there is a design error in the Intel architecture: the state of <code>OF</code>,
the overflow flag, is left undefined by the <code>idiv</code> instruction, so it faults instead.</p>
<p>The situation is worse on ARM and RISC-V processors because they fail to provide a divide instruction that takes a
double-wide dividend. I think the reason for this is that CPU designers do not like division. It is complex, it
takes up a lot of real estate, and it is slow. Having slow instructions in the instruction set can complicate timing.
These used to be valid excuses, but not anymore. Moore's Law is still in effect, so we should have complete division
instructions.</p>
<p>On cheap <code>int</code> machines, the scaling operator makes a great substitute for floating point. For example, to multiply by
π, just</p>
<pre>multiplicand × 355 ÷ 113</pre>
<p>which is very close to multiplying by 3.141593. </p>
<p>It is also ideal for implementing multiplication and division for scaled numbers.</p>
<pre>multiplicand × multiplier ÷ scale_factor
dividend × scale_factor ÷ divisor</pre>

    <h5><a href="https://www.crockford.com/scaled.html">Scaled numbers</a></h5>

</div>



</body></html>